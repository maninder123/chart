<!DOCTYPE html>

<html>
    <head>
        <title>D3 Grouped Bar-Chart</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <style>

                body {
                font: 10px sans-serif;
                }

                .axis path,
                .axis line {
                  fill: none;
                  stroke: #000;
                  shape-rendering: crispEdges;
                }

                .bar {
                  fill: steelblue;
                }

                .x.axis path {
                  //display: none;
                }

</style>

        <script src="js/libs/jquery/jquery.js"></script>
        <script src="js/libs/d3/d3.js"></script>
        
    </head>
    <body>
        
        <script>
                    //Defining The InerSvg Area
                    var margin  = {top: 20, right: 20, bottom: 30, left: 40},
                        width   = 960 - margin.left - margin.right,
                        height  = 500 - margin.top - margin.bottom;
                  
                   //Defining x-scale
                    var x0 = d3.scale.ordinal()
                               .rangeRoundBands([0, width], .2,0);

                    var x1 = d3.scale.ordinal();
                    
                    //Defining Y-scale
                    var y = d3.scale.linear()
                              .range([height, 0]);

                    //Defining Color-scale
                    var color = d3.scale.ordinal()
                                  .range(["#0037C5", "#ff0000", "#e0c918"]);
                    
                    //Defining x-Axis
                    var xAxis = d3.svg.axis()
                                  .scale(x0)
                                  .orient("bottom");
                
                    //Defining Y-Axis
                    var yAxis = d3.svg.axis()
                                  .scale(y)
                                  .orient("left")
                                  .tickFormat(d3.format(".2s"));
                    
                    //Creating The SVG Container
                    var svg = d3.select("body").append("svg")
                                               .attr("width", width + margin.left + margin.right)
                                               .attr("height", height + margin.top + margin.bottom)
                                               .append("g")
                                                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                    d3.csv("Data.csv", function(error, data) {
                    //----------------------------------------------------------------------------------------    
                            //*Geting all the age group names from the data
                            var socialMedia = d3.keys(data[0]).filter(function(key) { return (key == "% use social media")||(key == "% use social media on mobile")||(key == "% bought online on mobile"); });
                                
                                //*Assigning a new Propertie containing an array of to every elements in the data.
                                data.forEach(function(d) {
                                    d.socialMediaGroup = socialMedia.map(function(name) { return {name: name, value: parseInt(d[name])}; });
                                });
                            
                                //*Assigning domain to x-axis
                                //x0.domain(data.map(function(d) { return d.State; }));
                                x0.domain(d3.range(1,31));
                                
                                //Assigning domain and range to inner band of each group
                                x1.domain(socialMedia).rangeRoundBands([0, x0.rangeBand()]);
                                
                                //Assigning domain to the Y-Axis
                                //y.domain([0, d3.max(data, function(d) { return d3.max(d.socialMediaGroup, function(d) { return d.value; }); })]);
                                y.domain([0, 100]);
                                //Appending x-axis to the svg
                                svg.append("g")
                                    .attr("class", "x axis")
                                    .attr("transform", "translate(0," + height + ")")
                                    .call(xAxis);
                                
                                //Appending y-axis to the svg
                                svg.append("g")
                                    .attr("class", "y axis")
                                    .call(yAxis);
//                                    .append("text")
//                                     .attr("transform", "rotate(-90)")
//                                     .attr("y", 6)
//                                     .attr("dy", ".71em")
//                                     .style("text-anchor", "end")
//                                     .text("Population");
                             
                            //Creating Each state group in the svg and binding data to them
                            var state = svg.selectAll(".state")
                                           .data(data)
                                           .enter()
                                           .append("g")
                                            .attr("class", "state")
                                            .attr("transform", function(d,i) { return "translate(" + x0(i+1) + ",0)"; });
                            
                            //Creating rectangel for each update elements 
                                state.selectAll("rect")
                                     .data(function(d) { return d.socialMediaGroup; })
                                     .enter()
                                     .append("rect")
                                      .attr("width", x1.rangeBand())
                                      .attr("x", function(d) { return x1(d.name); })
                                      .attr("y", function(d) { return y(d.value); })
                                      .attr("height", function(d) { return height - y(d.value); })
                                      .style("fill", function(d) { return color(d.name); });
//---------------------------------------------------------------------------------
//                            var legend = svg.selectAll(".legend")
//                                            .data(ageNames.slice().reverse())
//                                            .enter()
//                                            .append("g")
//                                             .attr("class", "legend")
//                                             .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });
//
//                                legend.append("rect")
//                                       .attr("x", width - 18)
//                                       .attr("width", 18)
//                                       .attr("height", 18)
//                                       .style("fill", color);
//
//                                legend.append("text")
//                                       .attr("x", width - 24)
//                                       .attr("y", 9)
//                                       .attr("dy", ".35em")
//                                       .style("text-anchor", "end")
//                                       .text(function(d) { return d; });

                    });

        </script>
        <a href="D3 Line Chart.html">D3 Line Chart</a>
    </body>
</html>
